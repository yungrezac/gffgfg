<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∏—Ç–≤–∞ –°—Ç—Ä–∞–Ω - TikTok Live –í–∏–¥–∂–µ—Ç</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º React –∏ Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            overflow: hidden;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: white;
        }

        .demo-background {
            background: linear-gradient(135deg, rgba(15,23,42,0.98) 0%, rgba(0,0,0,1) 100%);
        }

        .progress-bar-transition { transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .score-pulse { animation: pulse-score 0.4s ease-out; }

        @keyframes pulse-score {
            0% { transform: scale(1); color: #fff; }
            50% { transform: scale(1.3); color: #00ff88; text-shadow: 0 0 10px #00ff88; }
            100% { transform: scale(1); color: #fff; }
        }

        @keyframes winnerPop {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1.1; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        .winner-anim { animation: winnerPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∂–µ—Å—Ç–∫–æ–≥–æ –≤—ã–±—ã–≤–∞–Ω–∏—è */
        @keyframes explode-out {
            0% { transform: scale(1); opacity: 1; filter: brightness(1); }
            20% { transform: scale(1.1); filter: brightness(2) contrast(2); border-color: red; }
            100% { transform: scale(0.8) translateY(20px); opacity: 0; filter: blur(5px); }
        }
        .eliminating-anim { animation: explode-out 1.5s ease-in-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- –î–ê–ù–ù–´–ï SUPABASE ---
        const SUPABASE_URL = 'https://zagvyrqnayxdbqkcjqud.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_glnqsWdFcmaHOzUrfD5fGA_dt6xiB1f';

        // --- –ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï (6 —Å—Ç—Ä–∞–Ω –¥–ª—è –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Ä–∞—É–Ω–¥–æ–≤) ---
        const COUNTRIES = [
            { id: 'ru', name: '–†–æ—Å—Å–∏—è' },
            { id: 'kz', name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω' },
            { id: 'ua', name: '–£–∫—Ä–∞–∏–Ω–∞' },
            { id: 'by', name: '–ë–µ–ª–∞—Ä—É—Å—å' },
            { id: 'uz', name: '–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω' },
            { id: 'kg', name: '–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω' },
        ];

        const MOCK_GIFT_LIBRARY = [
            { id: 'g1', name: '–†–æ–∑–∞', icon: 'üåπ', cost: 1 }, { id: 'g2', name: '–û–≥–æ–Ω—å', icon: 'üî•', cost: 1 },
            { id: 'g3', name: '–ß–∞–π', icon: '‚òï', cost: 1 }, { id: 'g4', name: '–õ–∞–π–∫', icon: 'üëç', cost: 1 },
            { id: 'g5', name: '–ö–æ—Ñ–µ', icon: 'ü•§', cost: 1 }, { id: 'g6', name: '–¶–≤–µ—Ç–æ–∫', icon: 'üåº', cost: 1 },
            { id: 'g7', name: '–ü–æ–Ω—á–∏–∫', icon: 'üç©', cost: 5 }, { id: 'g8', name: '–ú–æ—Ä–æ–∂–µ–Ω–æ–µ', icon: 'üç¶', cost: 5 },
            { id: 'g9', name: '–°–µ—Ä–¥—Ü–µ', icon: '‚ù§Ô∏è', cost: 10 }, { id: 'g10', name: 'GG', icon: 'üéÆ', cost: 10 },
            { id: 'g11', name: '–ú–∏—à–∫–∞', icon: 'üß∏', cost: 100 }, { id: 'g12', name: '–ê–ª–º–∞–∑', icon: 'üíé', cost: 150 },
            { id: 'g13', name: '–û—á–∫–∏', icon: 'üï∂Ô∏è', cost: 199 }, { id: 'g14', name: '–ú–∞–≥–∏—è', icon: '‚ú®', cost: 250 },
            { id: 'g15', name: '–ö–æ—Ä–≥–∏', icon: 'üê∂', cost: 299 }, { id: 'g16', name: '–ö–æ—Ä–æ–Ω–∞', icon: 'üëë', cost: 500 },
            { id: 'g17', name: '–ö–æ—Ç', icon: 'üê±', cost: 500 }, { id: 'g18', name: '–ú–∞—à–∏–Ω–∞', icon: 'üèéÔ∏è', cost: 800 },
            { id: 'g19', name: '–ì–∞–ª–∞–∫—Ç–∏–∫–∞', icon: 'üåå', cost: 1000 }, { id: 'g20', name: '–†–∞–∫–µ—Ç–∞', icon: 'üöÄ', cost: 1500 },
            { id: 'g21', name: '–ö–∏—Ç', icon: 'üêã', cost: 2150 }, { id: 'g22', name: '–í–µ—Ä—Ç–æ–ª–µ—Ç', icon: 'üöÅ', cost: 3000 },
            { id: 'g23', name: '–î—Ä–∞–∫–æ–Ω', icon: 'üêâ', cost: 5000 }, { id: 'g24', name: '–ó–∞–º–æ–∫', icon: 'üè∞', cost: 20000 },
            { id: 'g25', name: '–õ–µ–≤', icon: 'ü¶Å', cost: 29999 }, { id: 'g26', name: '–§–µ–Ω–∏–∫—Å', icon: 'ü¶Ö', cost: 35000 },
            { id: 'g27', name: '–Ø–±–ª–æ–∫–æ', icon: 'üçé', cost: 5 }, { id: 'g28', name: '–ü–∏—Ü—Ü–∞', icon: 'üçï', cost: 20 },
            { id: 'g29', name: '–¢–æ—Ä—Ç', icon: 'üéÇ', cost: 300 }, { id: 'g30', name: '–Ø—Ö—Ç–∞', icon: 'üõ•Ô∏è', cost: 9000 },
            { id: 'g31', name: '–ü–ª–∞–Ω–µ—Ç–∞', icon: 'ü™ê', cost: 15000 }, { id: 'g32', name: '–¢–∏–≥—Ä', icon: 'üêØ', cost: 34999 }
        ];

        const MOCK_NAMES = ["User_99", "AlexPro", "Elena_V", "TiktokKing", "DarkKnight", "Winner_01", "CatLover", "Stark"];

        // --- –ù–ê–°–¢–†–û–ô–ö–ò –ê–î–ê–ü–¢–ò–í–ù–´–• –†–ê–ó–ú–ï–†–û–í (–Ω–µ–º–Ω–æ–≥–æ —Å–∂–∞—Ç—ã –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ –≤–µ—Ä—Ö–∞) ---
        const RANK_SIZES = [
            { h: 56, font: 'text-xl', scoreFont: 'text-2xl', flag: 'w-10 h-7', pad: 'p-3', border: 'border-green-500/50', bg: 'bg-black/80' },  // 1 –º–µ—Å—Ç–æ
            { h: 48, font: 'text-lg', scoreFont: 'text-xl',  flag: 'w-8 h-6',  pad: 'p-2.5', border: 'border-white/10', bg: 'bg-black/60' },  // 2 –º–µ—Å—Ç–æ
            { h: 42, font: 'text-base', scoreFont: 'text-lg',  flag: 'w-7 h-5',  pad: 'p-2', border: 'border-white/10', bg: 'bg-black/60' },    // 3 –º–µ—Å—Ç–æ
            { h: 36, font: 'text-sm', scoreFont: 'text-base',  flag: 'w-6 h-4',  pad: 'px-2 py-1.5', border: 'border-white/10', bg: 'bg-black/50' },// 4 –º–µ—Å—Ç–æ
            { h: 32, font: 'text-xs', scoreFont: 'text-sm',  flag: 'w-5 h-3.5',pad: 'px-2 py-1', border: 'border-white/5', bg: 'bg-black/40' }, // 5 –º–µ—Å—Ç–æ
            { h: 28, font: 'text-[10px]', scoreFont: 'text-xs',  flag: 'w-4 h-3',  pad: 'px-2 py-1', border: 'border-white/5', bg: 'bg-black/40' }  // 6 –º–µ—Å—Ç–æ
        ];
        const LIST_GAP = 5; // –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏ —É–º–µ–Ω—å—à–µ–Ω —Å 6 –¥–æ 5

        // --- –ò–ì–†–û–í–´–ï –¢–ê–ô–ú–ò–ù–ì–ò ---
        const TOTAL_ROUNDS = 30;
        const ROUND_PLAY_SECONDS = 60;   // 1 –º–∏–Ω—É—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∏–≥—Ä—ã –¥–æ –≤—ã–±—ã–≤–∞–Ω–∏—è
        const ROUND_ELIM_SECONDS = 4;    // –í—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–±—ã–≤–∞–Ω–∏—è –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ
        const ROUND_PAUSE_SECONDS = 10;  // –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞
        const ROUND_CELEB_SECONDS = 5;   // –ü—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Ä–∞—É–Ω–¥–∞
        const ROUND_BREAK_SECONDS = 60;  // –ü–µ—Ä–µ—Ä—ã–≤ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏ (1 –º–∏–Ω—É—Ç–∞)

        const formatTime = (seconds) => {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        };

        const App = () => {
            const [giftLibrary, setGiftLibrary] = useState([]);
            const [isLoadingGifts, setIsLoadingGifts] = useState(true);
            
            const [scores, setScores] = useState({});
            const [wins, setWins] = useState({});
            const [activeCountries, setActiveCountries] = useState(COUNTRIES.map(c => c.id));
            const [round, setRound] = useState(1);
            
            // –§–∞–∑—ã: PLAYING -> ELIMINATING -> PAUSED -> (—Ü–∏–∫–ª) -> CELEBRATING -> ROUND_BREAK -> PLAYING
            const [phase, setPhase] = useState('PLAYING'); 
            const [timeLeft, setTimeLeft] = useState(ROUND_PLAY_SECONDS);
            const [eliminatedJustNow, setEliminatedJustNow] = useState(null); 
            
            const [pulsingIds, setPulsingIds] = useState(new Set());
            const [isDemoActive, setIsDemoActive] = useState(true);

            // --- –ó–ê–ì–†–£–ó–ö–ê –ü–û–î–ê–†–ö–û–í ---
            useEffect(() => {
                const fetchGifts = async () => {
                    try {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/gift_library?select=*`, {
                            headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                        });
                        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                        const data = await response.json();
                        if (data && data.length >= 24) setGiftLibrary(data);
                        else setGiftLibrary(MOCK_GIFT_LIBRARY);
                    } catch (error) {
                        setGiftLibrary(MOCK_GIFT_LIBRARY); 
                    } finally {
                        setIsLoadingGifts(false);
                    }
                };
                fetchGifts();
            }, []);

            // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–æ–≤
            const countryGifts = useMemo(() => {
                if (giftLibrary.length === 0) return {};
                const map = {};
                let sortedLib = [...giftLibrary].sort((a,b) => (a.cost || 0) - (b.cost || 0));
                const tierSize = Math.floor(sortedLib.length / 4);
                const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
                const cheap = shuffle(sortedLib.slice(0, tierSize));
                const medium = shuffle(sortedLib.slice(tierSize, tierSize * 2));
                const expensive = shuffle(sortedLib.slice(tierSize * 2, tierSize * 3));
                const superExpensive = shuffle(sortedLib.slice(tierSize * 3));
                
                COUNTRIES.forEach((country, index) => {
                    map[country.id] = [
                        cheap[index % cheap.length],
                        medium[index % medium.length],
                        expensive[index % expensive.length],
                        superExpensive[index % superExpensive.length]
                    ].filter(Boolean);
                });
                return map;
            }, [giftLibrary]);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            useEffect(() => {
                if (activeCountries.length === COUNTRIES.length && Object.keys(scores).length === 0) {
                    const initialScores = {};
                    COUNTRIES.forEach(c => initialScores[c.id] = 0);
                    setScores(initialScores);
                    const initialWins = {};
                    COUNTRIES.forEach(c => initialWins[c.id] = 0);
                    setWins(initialWins);
                }
            }, []);

            // --- –ú–ê–®–ò–ù–ê –°–û–°–¢–û–Ø–ù–ò–ô (–¢–ê–ô–ú–ï–† –ò–ì–†–´) ---
            useEffect(() => {
                if (isLoadingGifts || phase === 'GAME_OVER') return;

                const timer = setInterval(() => {
                    setTimeLeft(prev => prev - 1);
                }, 1000);

                return () => clearInterval(timer);
            }, [phase, isLoadingGifts]);

            // --- –õ–û–ì–ò–ö–ê –§–ê–ó (–ü–µ—Ä–µ—Ö–æ–¥—ã –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏) ---
            useEffect(() => {
                if (timeLeft <= 0) {
                    if (phase === 'PLAYING') {
                        let minScore = Infinity;
                        let lowestId = null;
                        activeCountries.forEach(id => {
                            const s = scores[id] || 0;
                            if (s < minScore) {
                                minScore = s;
                                lowestId = id;
                            }
                        });
                        setEliminatedJustNow(lowestId);
                        setPhase('ELIMINATING');
                        setTimeLeft(ROUND_ELIM_SECONDS);
                    } 
                    else if (phase === 'ELIMINATING') {
                        const newActive = activeCountries.filter(id => id !== eliminatedJustNow);
                        setActiveCountries(newActive);
                        setEliminatedJustNow(null);
                        
                        if (newActive.length === 1) {
                            setPhase('CELEBRATING');
                            setWins(w => ({ ...w, [newActive[0]]: (w[newActive[0]] || 0) + 1 }));
                            setTimeLeft(ROUND_CELEB_SECONDS);
                        } else {
                            setPhase('PAUSED');
                            setTimeLeft(ROUND_PAUSE_SECONDS);
                        }
                    }
                    else if (phase === 'PAUSED') {
                        setPhase('PLAYING');
                        setTimeLeft(ROUND_PLAY_SECONDS);
                    }
                    else if (phase === 'CELEBRATING') {
                        if (round < TOTAL_ROUNDS) {
                            setPhase('ROUND_BREAK');
                            setTimeLeft(ROUND_BREAK_SECONDS);
                        } else {
                            setPhase('GAME_OVER');
                        }
                    }
                    else if (phase === 'ROUND_BREAK') {
                        setRound(r => r + 1);
                        setActiveCountries(COUNTRIES.map(c => c.id));
                        const resetScores = {};
                        COUNTRIES.forEach(c => resetScores[c.id] = 0);
                        setScores(resetScores);
                        setPhase('PLAYING');
                        setTimeLeft(ROUND_PLAY_SECONDS);
                    }
                }
            }, [timeLeft, phase, activeCountries, scores, eliminatedJustNow, round]);

            // --- –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–î–ê–†–ö–ê ---
            const handleGift = (countryId, giftInfo) => {
                if (!activeCountries.includes(countryId) || phase !== 'PLAYING') return;
                if (!giftInfo) return;

                const cost = giftInfo.cost || 0;
                setScores(prev => ({ ...prev, [countryId]: (prev[countryId] || 0) + cost }));

                setPulsingIds(prev => new Set(prev).add(countryId));
                setTimeout(() => {
                    setPulsingIds(prev => {
                        const newSet = new Set(prev);
                        newSet.delete(countryId);
                        return newSet;
                    });
                }, 400);
            };

            // --- –°–ò–ú–£–õ–Ø–¢–û–† –î–û–ù–ê–¢–û–í ---
            useEffect(() => {
                if (!isDemoActive || phase !== 'PLAYING' || isLoadingGifts) return;

                const interval = setInterval(() => {
                    if (activeCountries.length === 0) return;
                    
                    const randomCountryId = activeCountries[Math.floor(Math.random() * activeCountries.length)];
                    const countryAvailGifts = countryGifts[randomCountryId];
                    if (!countryAvailGifts || countryAvailGifts.length === 0) return;
                    
                    const rand = Math.random();
                    let giftIdx = 0;
                    if (rand > 0.6 && rand <= 0.9) giftIdx = Math.min(1, countryAvailGifts.length - 1);
                    else if (rand > 0.9 && rand <= 0.98) giftIdx = Math.min(2, countryAvailGifts.length - 1);
                    else if (rand > 0.98) giftIdx = Math.min(3, countryAvailGifts.length - 1);

                    const gift = countryAvailGifts[giftIdx];
                    if (!gift) return;

                    handleGift(randomCountryId, gift);
                }, Math.random() * 800 + 400);

                return () => clearInterval(interval);
            }, [isDemoActive, phase, activeCountries, countryGifts, isLoadingGifts]);

            // --- –°–û–†–¢–ò–†–û–í–ö–ê –î–õ–Ø –õ–ò–î–ï–†–ë–û–†–î–ê ---
            const sortedCountriesWithEliminating = useMemo(() => {
                const listToRender = phase === 'ELIMINATING' && eliminatedJustNow && !activeCountries.includes(eliminatedJustNow)
                    ? [...activeCountries, eliminatedJustNow] 
                    : activeCountries;

                return listToRender
                    .map(id => ({ ...COUNTRIES.find(c => c.id === id), score: scores[id] || 0 }))
                    .sort((a, b) => b.score - a.score);
            }, [activeCountries, scores, phase, eliminatedJustNow]);

            const maxScore = sortedCountriesWithEliminating[0]?.score || 1;
            const roundWinner = phase === 'CELEBRATING' ? COUNTRIES.find(c => c.id === activeCountries[0]) : null;

            if (isLoadingGifts) {
                return (
                    <div className="w-full h-screen demo-background flex items-center justify-center text-white font-sans text-2xl animate-pulse">
                        –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...
                    </div>
                );
            }

            return (
                <div className="w-full h-screen demo-background flex flex-col items-center overflow-hidden text-white font-sans relative">
                    
                    {/* –ö–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è –¥–µ–º–æ */}
                    <button 
                        onClick={() => setIsDemoActive(!isDemoActive)} 
                        className={`absolute top-4 right-4 z-50 text-[10px] px-2.5 py-1 rounded-full border ${isDemoActive ? 'border-green-500 text-green-400 bg-green-500/10' : 'border-gray-500 text-gray-400 bg-gray-500/10'} cursor-pointer hover:bg-white/10 transition-colors backdrop-blur-sm shadow-lg`}
                    >
                        {isDemoActive ? 'Demo ON' : 'Demo OFF'}
                    </button>

                    {/* --- –ö–†–ê–°–ò–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–û–ë–ï–î (–£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø) --- */}
                    <div className="w-full shrink-0 h-[22%] min-h-[160px] flex flex-col items-center justify-center p-3 pt-4 z-10 relative">
                        <div className="absolute inset-0 bg-gradient-to-b from-yellow-500/10 to-transparent pointer-events-none"></div>
                        
                        <h3 className="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-yellow-500 to-yellow-300 uppercase tracking-[0.2em] drop-shadow-md mb-3 flex items-center gap-2">
                            <span className="text-2xl">üèÜ</span> –¢–∞–±–ª–∏—Ü–∞ –ø–æ–±–µ–¥ <span className="text-2xl">üèÜ</span>
                        </h3>
                        
                        <div className="grid grid-cols-3 gap-3 w-full max-w-[460px]">
                            {COUNTRIES.map(c => (
                                <div key={c.id} className="bg-black/50 border border-white/10 rounded-xl p-3 flex items-center backdrop-blur-xl shadow-[0_4px_15px_rgba(0,0,0,0.5)] transition-transform hover:scale-105">
                                    <img src={`https://flagcdn.com/w80/${c.id}.png`} className="w-10 h-7 rounded-sm shadow-sm mr-3 border border-white/10 object-cover" alt={c.name} />
                                    <div className="flex flex-col justify-center">
                                        <span className="text-xs text-gray-400 uppercase tracking-widest leading-none mb-1.5 truncate max-w-[70px]">{c.name}</span>
                                        <div className="flex items-end gap-1 leading-none">
                                            <span className="text-3xl font-black text-green-400 drop-shadow-[0_0_8px_rgba(0,255,136,0.4)] leading-none">{wins[c.id] || 0}</span>
                                            <span className="text-[10px] text-gray-500 uppercase tracking-wider mb-1">–ø–æ–±–µ–¥</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* --- –¢–ê–ô–ú–ï–† –ò –§–ê–ó–ê (–£–í–ï–õ–ò–ß–ï–ù–ù–´–ï) --- */}
                    <div className="w-full shrink-0 h-[10%] min-h-[80px] flex flex-col items-center justify-center z-20 relative">
                        <div className="flex items-center gap-5">
                            <div className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-yellow-500 uppercase tracking-widest drop-shadow-[0_0_10px_rgba(255,105,180,0.5)]">
                                –†–∞—É–Ω–¥ {round}/{TOTAL_ROUNDS}
                            </div>
                            
                            <div className={`text-5xl font-black font-mono drop-shadow-[0_0_15px_rgba(0,0,0,0.8)] transition-colors duration-300
                                ${(phase === 'ELIMINATING' || phase === 'PAUSED') ? 'text-red-500 animate-pulse' : 
                                  (phase === 'PLAYING' && timeLeft <= 10) ? 'text-red-400 animate-pulse' : 'text-cyan-400'}`}>
                                {formatTime(timeLeft)}
                            </div>
                        </div>
                        
                        <div className="text-sm text-gray-400 uppercase tracking-widest mt-2 text-center">
                            {phase === 'PLAYING' ? '–î–æ –≤—ã–±—ã–≤–∞–Ω–∏—è' : 
                             phase === 'ELIMINATING' ? '–í—ã–±—ã–≤–∞–Ω–∏–µ...' : 
                             phase === 'PAUSED' ? '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑' : 
                             phase === 'CELEBRATING' ? '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å!' : 
                             phase === 'ROUND_BREAK' ? '–ü–µ—Ä–µ—Ä—ã–≤' : '–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã'}
                        </div>
                    </div>

                    {/* --- –ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ï–ô–¢–ò–ù–ì –ù–ê –í–°–Æ –®–ò–†–ò–ù–£ --- */}
                    <div className="w-full flex-1 relative px-2 z-10 flex flex-col justify-center items-center min-h-[100px]">
                        
                        {phase === 'CELEBRATING' && roundWinner && (
                            <div className="absolute inset-0 z-50 flex items-center justify-center winner-anim">
                                <div className="bg-gradient-to-br from-yellow-500 via-orange-500 to-red-500 p-0.5 rounded-3xl shadow-[0_0_80px_rgba(255,165,0,0.8)]">
                                    <div className="bg-black/95 rounded-[22px] px-8 py-6 text-center backdrop-blur-xl flex flex-col items-center border border-yellow-500/30">
                                        <img src={`https://flagcdn.com/w80/${roundWinner.id}.png`} className="w-20 h-auto rounded-md drop-shadow-2xl mb-3 border border-white/20" alt="winner" />
                                        <h2 className="text-2xl font-black text-white uppercase tracking-wider mb-1">–ü–û–ë–ï–î–ò–¢–ï–õ–¨ –†–ê–£–ù–î–ê!</h2>
                                        <h3 className="text-lg text-yellow-400 font-bold">+1 –≤ –∫–æ–ø–∏–ª–∫—É</h3>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="relative w-full" style={{ 
                            height: `${sortedCountriesWithEliminating.reduce((sum, _, i) => sum + (RANK_SIZES[i]?.h || 30) + LIST_GAP, 0)}px` 
                        }}>
                            {sortedCountriesWithEliminating.map((country, index) => {
                                const rankConfig = RANK_SIZES[index] || RANK_SIZES[RANK_SIZES.length - 1];
                                
                                let translateY = 0;
                                for (let i = 0; i < index; i++) translateY += (RANK_SIZES[i]?.h || 30) + LIST_GAP;

                                const isLastInPlaying = index === sortedCountriesWithEliminating.length - 1 && phase === 'PLAYING';
                                const isDanger = isLastInPlaying && timeLeft <= 10;
                                const isEliminatingNow = phase === 'ELIMINATING' && country.id === eliminatedJustNow;
                                const isPulsing = pulsingIds.has(country.id);
                                const progressPercentage = Math.max(2, (country.score / maxScore) * 100);

                                return (
                                    <div 
                                        key={country.id}
                                        className={`absolute left-0 right-0 rounded-2xl flex items-center overflow-hidden border transition-all duration-500 ease-in-out
                                            ${rankConfig.bg} ${rankConfig.pad}
                                            ${isDanger ? 'border-red-500/80 shadow-[0_0_20px_rgba(255,0,0,0.6)] animate-pulse bg-red-950/40' : rankConfig.border}
                                            ${isEliminatingNow ? 'eliminating-anim z-50' : 'z-20'}
                                        `}
                                        style={{ 
                                            transform: `translateY(${translateY}px)`, 
                                            height: `${rankConfig.h}px`,
                                            zIndex: 20 - index
                                        }}
                                    >
                                        <img src={`https://flagcdn.com/w80/${country.id}.png`} className={`${rankConfig.flag} rounded-sm object-cover mr-3 drop-shadow-md border border-white/10`} alt={country.name} />
                                        <div className={`font-bold text-white flex-1 ${rankConfig.font} truncate`}>{country.name}</div>
                                        <div className="flex flex-col items-end z-10 ml-2">
                                            <span className={`font-black tabular-nums ${rankConfig.scoreFont} ${isPulsing ? 'score-pulse' : ''} ${isDanger ? 'text-white' : 'text-green-400'}`}>
                                                {country.score.toLocaleString('ru-RU')}
                                            </span>
                                        </div>
                                        <div className="absolute top-0 left-0 h-full rounded-2xl overflow-hidden opacity-30 pointer-events-none w-full">
                                            <div className="h-full progress-bar-transition bg-gradient-to-r from-green-500 to-cyan-500" style={{ width: `${progressPercentage}%` }}></div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* --- –°–ï–¢–ö–ê –ü–û–î–ê–†–ö–û–í –í–ù–ò–ó–£ (38% –í–´–°–û–¢–´) --- */}
                    <div className="w-full shrink-0 h-[38%] bg-black/95 border-t border-white/10 p-2 pb-10 z-30 flex flex-col backdrop-blur-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.9)]">
                        <div className="text-center text-[11px] font-bold text-gray-400 uppercase tracking-widest mb-1.5 mt-0.5">
                            ‚¨áÔ∏è –ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å—Ç—Ä–∞–Ω ‚¨áÔ∏è
                        </div>
                        <div className="grid grid-cols-3 grid-rows-2 gap-2 h-full pb-1">
                            {COUNTRIES.map(country => {
                                const isActive = activeCountries.includes(country.id);
                                const isEliminatingNow = phase === 'ELIMINATING' && country.id === eliminatedJustNow;
                                const effectivelyActive = isActive || isEliminatingNow;
                                const gifts = countryGifts[country.id] || [];

                                return (
                                    <div key={country.id} className={`flex flex-col rounded-xl border ${effectivelyActive ? 'bg-white/5 border-white/10' : 'bg-black border-red-900/50 opacity-30 grayscale'} overflow-hidden relative transition-all duration-500`}>
                                        
                                        <div className="bg-white/10 py-1.5 flex items-center justify-center gap-2 border-b border-white/5 shrink-0">
                                            <img src={`https://flagcdn.com/w80/${country.id}.png`} className="w-5 h-3.5 rounded-sm object-cover drop-shadow-sm border border-white/20" alt={country.name} />
                                            <span className="text-[11px] font-bold text-white truncate max-w-[80px] uppercase tracking-wider">{country.name}</span>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 grid-rows-2 flex-1 p-1 gap-1">
                                            {gifts.map((gift, idx) => gift ? (
                                                <div key={gift.id || idx} className="bg-black/60 rounded-lg flex flex-col items-center justify-center relative overflow-hidden group">
                                                    {gift.icon && gift.icon.startsWith('http') ? (
                                                        <img src={gift.icon} className="w-12 h-12 object-contain mb-1 drop-shadow-[0_0_8px_rgba(255,255,255,0.4)]" alt={gift.name} />
                                                    ) : (
                                                        <span className="text-4xl mb-1 drop-shadow-[0_0_8px_rgba(255,255,255,0.4)]">{gift.icon}</span>
                                                    )}
                                                    <div className="flex items-center text-[11px] font-black text-yellow-400 bg-black/80 px-2.5 py-0.5 rounded-full border border-yellow-500/30">
                                                        {gift.cost}
                                                    </div>
                                                </div>
                                            ) : null)}
                                        </div>

                                        {!effectivelyActive && (
                                            <div className="absolute inset-0 bg-red-900/50 flex items-center justify-center backdrop-blur-[2px] z-10">
                                                <span className="text-red-500 font-black uppercase text-base rotate-[-15deg] border-2 border-red-500 px-2 py-0.5 rounded bg-black/80 shadow-[0_0_10px_rgba(255,0,0,0.5)]">–í–´–ë–´–õ</span>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* --- –ü–ï–†–ï–†–´–í –ú–ï–ñ–î–£ –†–ê–£–ù–î–ê–ú–ò (1 –ú–ò–ù–£–¢–ê –ù–ê –í–ï–°–¨ –≠–ö–†–ê–ù) --- */}
                    {phase === 'ROUND_BREAK' && (
                        <div className="absolute inset-0 z-[100] bg-black/95 backdrop-blur-3xl flex flex-col items-center justify-center p-6 text-center winner-anim">
                            <div className="w-24 h-24 mb-6 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"></div>
                            <h2 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 uppercase tracking-widest mb-4">
                                –ü–µ—Ä–µ—Ä—ã–≤ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏
                            </h2>
                            <div className="text-[120px] leading-none font-black font-mono text-white drop-shadow-[0_0_40px_rgba(255,255,255,0.6)] mb-6">
                                {formatTime(timeLeft)}
                            </div>
                            <div className="text-lg text-gray-400 uppercase tracking-widest mt-4 bg-white/10 px-6 py-2 rounded-full border border-white/5">
                                –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞!
                            </div>
                        </div>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
