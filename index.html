<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∏—Ç–≤–∞ –°—Ç—Ä–∞–Ω - TikTok Live –í–∏–¥–∂–µ—Ç</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º React –∏ Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: transparent; /* –û—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –¥–ª—è OBS */
            overflow: hidden;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: white;
        }

        /* –î–µ–º–æ-—Ñ–æ–Ω (—É–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ö—Ä–æ–º–∞–∫–µ—è –≤ OBS) */
        .demo-background {
            background: linear-gradient(135deg, rgba(15,23,42,0.95) 0%, rgba(0,0,0,0.98) 100%);
        }

        .progress-bar-transition { transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .score-pulse { animation: pulse-score 0.4s ease-out; }

        @keyframes pulse-score {
            0% { transform: scale(1); color: #fff; }
            50% { transform: scale(1.3); color: #00ff88; text-shadow: 0 0 10px #00ff88; }
            100% { transform: scale(1); color: #fff; }
        }

        @keyframes winnerPop {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        .winner-anim { animation: winnerPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- –î–ê–ù–ù–´–ï SUPABASE ---
        const SUPABASE_URL = 'https://zagvyrqnayxdbqkcjqud.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_glnqsWdFcmaHOzUrfD5fGA_dt6xiB1f';

        // --- –ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï (6 —Å—Ç—Ä–∞–Ω –¥–ª—è –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Ä–∞—É–Ω–¥–æ–≤) ---
        const COUNTRIES = [
            { id: 'ru', name: '–†–æ—Å—Å–∏—è', flag: 'üá∑üá∫' },
            { id: 'kz', name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', flag: 'üá∞üáø' },
            { id: 'ua', name: '–£–∫—Ä–∞–∏–Ω–∞', flag: 'üá∫üá¶' },
            { id: 'by', name: '–ë–µ–ª–∞—Ä—É—Å—å', flag: 'üáßüáæ' },
            { id: 'uz', name: '–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω', flag: 'üá∫üáø' },
            { id: 'kg', name: '–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω', flag: 'üá∞üá¨' },
        ];

        // --- –†–ï–ó–ï–†–í–ù–ê–Ø –ë–ò–ë–õ–ò–û–¢–ï–ö–ê (–ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ë–î –ø—É—Å—Ç–∞—è –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞) ---
        const MOCK_GIFT_LIBRARY = [
            { id: 'g1', name: '–†–æ–∑–∞', icon: 'üåπ', cost: 1 }, { id: 'g2', name: '–û–≥–æ–Ω—å', icon: 'üî•', cost: 1 },
            { id: 'g3', name: '–ß–∞–π', icon: '‚òï', cost: 1 }, { id: 'g4', name: '–õ–∞–π–∫', icon: 'üëç', cost: 1 },
            { id: 'g5', name: '–ö–æ—Ñ–µ', icon: 'ü•§', cost: 1 }, { id: 'g6', name: '–¶–≤–µ—Ç–æ–∫', icon: 'üåº', cost: 1 },
            { id: 'g7', name: '–ü–æ–Ω—á–∏–∫', icon: 'üç©', cost: 5 }, { id: 'g8', name: '–ú–æ—Ä–æ–∂–µ–Ω–æ–µ', icon: 'üç¶', cost: 5 },
            { id: 'g9', name: '–°–µ—Ä–¥—Ü–µ', icon: '‚ù§Ô∏è', cost: 10 }, { id: 'g10', name: 'GG', icon: 'üéÆ', cost: 10 },
            { id: 'g11', name: '–ú–∏—à–∫–∞', icon: 'üß∏', cost: 100 }, { id: 'g12', name: '–ê–ª–º–∞–∑', icon: 'üíé', cost: 150 },
            { id: 'g13', name: '–û—á–∫–∏', icon: 'üï∂Ô∏è', cost: 199 }, { id: 'g14', name: '–ú–∞–≥–∏—è', icon: '‚ú®', cost: 250 },
            { id: 'g15', name: '–ö–æ—Ä–≥–∏', icon: 'üê∂', cost: 299 }, { id: 'g16', name: '–ö–æ—Ä–æ–Ω–∞', icon: 'üëë', cost: 500 },
            { id: 'g17', name: '–ö–æ—Ç', icon: 'üê±', cost: 500 }, { id: 'g18', name: '–ú–∞—à–∏–Ω–∞', icon: 'üèéÔ∏è', cost: 800 },
            { id: 'g19', name: '–ì–∞–ª–∞–∫—Ç–∏–∫–∞', icon: 'üåå', cost: 1000 }, { id: 'g20', name: '–†–∞–∫–µ—Ç–∞', icon: 'üöÄ', cost: 1500 },
            { id: 'g21', name: '–ö–∏—Ç', icon: 'üêã', cost: 2150 }, { id: 'g22', name: '–í–µ—Ä—Ç–æ–ª–µ—Ç', icon: 'üöÅ', cost: 3000 },
            { id: 'g23', name: '–î—Ä–∞–∫–æ–Ω', icon: 'üêâ', cost: 5000 }, { id: 'g24', name: '–ó–∞–º–æ–∫', icon: 'üè∞', cost: 20000 },
            { id: 'g25', name: '–õ–µ–≤', icon: 'ü¶Å', cost: 29999 }, { id: 'g26', name: '–§–µ–Ω–∏–∫—Å', icon: 'ü¶Ö', cost: 35000 },
            { id: 'g27', name: '–Ø–±–ª–æ–∫–æ', icon: 'üçé', cost: 5 }, { id: 'g28', name: '–ü–∏—Ü—Ü–∞', icon: 'üçï', cost: 20 },
            { id: 'g29', name: '–¢–æ—Ä—Ç', icon: 'üéÇ', cost: 300 }, { id: 'g30', name: '–Ø—Ö—Ç–∞', icon: 'üõ•Ô∏è', cost: 9000 },
            { id: 'g31', name: '–ü–ª–∞–Ω–µ—Ç–∞', icon: 'ü™ê', cost: 15000 }, { id: 'g32', name: '–¢–∏–≥—Ä', icon: 'üêØ', cost: 34999 }
        ];

        // –ò–º–µ–Ω–∞ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –¥–æ–Ω–∞—Ç–µ—Ä–æ–≤
        const MOCK_NAMES = ["User_99", "AlexPro", "Elena_V", "TiktokKing", "DarkKnight", "Winner_01", "CatLover", "Stark"];

        const TOTAL_ROUNDS = 30;
        const ROUND_TIMER_SECONDS = 15; // –°–µ–∫—É–Ω–¥ –¥–æ –≤—ã–±—ã–≤–∞–Ω–∏—è —Å–ª–∞–±–µ–π—à–µ–≥–æ

        const App = () => {
            // --- –°–û–°–¢–û–Ø–ù–ò–Ø ---
            const [giftLibrary, setGiftLibrary] = useState([]);
            const [isLoadingGifts, setIsLoadingGifts] = useState(true);
            
            const [scores, setScores] = useState({});
            const [wins, setWins] = useState({});
            const [activeCountries, setActiveCountries] = useState(COUNTRIES.map(c => c.id));
            const [round, setRound] = useState(1);
            
            // 'PLAYING' | 'CELEBRATING' | 'GAME_OVER'
            const [phase, setPhase] = useState('PLAYING'); 
            const [timeLeft, setTimeLeft] = useState(ROUND_TIMER_SECONDS);
            
            const [pulsingIds, setPulsingIds] = useState(new Set());
            const [isDemoActive, setIsDemoActive] = useState(true);

            // --- –ó–ê–ì–†–£–ó–ö–ê –ü–û–î–ê–†–ö–û–í –ò–ó SUPABASE ---
            useEffect(() => {
                const fetchGifts = async () => {
                    try {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/gift_library?select=*`, {
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`
                            }
                        });
                        
                        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö');
                        
                        const data = await response.json();
                        
                        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (–º–∏–Ω–∏–º—É–º 24 –ø–æ–¥–∞—Ä–∫–∞ –¥–ª—è 6 —Å—Ç—Ä–∞–Ω), –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
                        if (data && data.length >= 24) {
                            setGiftLibrary(data);
                        } else {
                            console.warn("–í Supabase –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥–∞—Ä–∫–æ–≤ (–Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 24). –ò—Å–ø–æ–ª—å–∑—É—é —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.");
                            setGiftLibrary(MOCK_GIFT_LIBRARY);
                        }
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Supabase:", error);
                        setGiftLibrary(MOCK_GIFT_LIBRARY); // –§–æ–ª–±—ç–∫ –Ω–∞ –∑–∞–º–æ–∫–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    } finally {
                        setIsLoadingGifts(false);
                    }
                };

                fetchGifts();
            }, []);

            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–∞ 6 —Å—Ç—Ä–∞–Ω (–ø–æ 4 —à—Ç—É–∫–∏ –∫–∞–∂–¥–æ–π –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
            const countryGifts = useMemo(() => {
                if (giftLibrary.length === 0) return {};
                
                const map = {};
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–¥–∞—Ä–∫–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ü–µ–Ω—ã
                let sortedLib = [...giftLibrary].sort((a,b) => (a.cost || 0) - (b.cost || 0));
                
                // –î–µ–ª–∏–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –Ω–∞ 4 —Ü–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                const tierSize = Math.floor(sortedLib.length / 4);
                const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
                
                const cheap = shuffle(sortedLib.slice(0, tierSize));
                const medium = shuffle(sortedLib.slice(tierSize, tierSize * 2));
                const expensive = shuffle(sortedLib.slice(tierSize * 2, tierSize * 3));
                const superExpensive = shuffle(sortedLib.slice(tierSize * 3));
                
                // –†–∞–∑–¥–∞–µ–º –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–µ –ø–æ –æ–¥–Ω–æ–º—É —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –ø–æ–¥–∞—Ä–∫—É –∏–∑ –∫–∞–∂–¥–æ–π —Ü–µ–Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                COUNTRIES.forEach((country, index) => {
                    map[country.id] = [
                        cheap[index % cheap.length],
                        medium[index % medium.length],
                        expensive[index % expensive.length],
                        superExpensive[index % superExpensive.length]
                    ].filter(Boolean);
                });
                return map;
            }, [giftLibrary]);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ/–Ω–æ–≤–æ–º —Ä–∞—É–Ω–¥–µ
            useEffect(() => {
                if (phase === 'PLAYING' && activeCountries.length === COUNTRIES.length) {
                    const initialScores = {};
                    COUNTRIES.forEach(c => initialScores[c.id] = 0);
                    setScores(initialScores);
                    
                    if (Object.keys(wins).length === 0) {
                        const initialWins = {};
                        COUNTRIES.forEach(c => initialWins[c.id] = 0);
                        setWins(initialWins);
                    }
                }
            }, [phase, activeCountries]);

            // --- –ò–ì–†–û–í–û–ô –¶–ò–ö–õ (–¢–ê–ô–ú–ï–† –ò –í–´–ë–´–í–ê–ù–ò–ï) ---
            useEffect(() => {
                if (!isDemoActive || phase !== 'PLAYING' || isLoadingGifts) return;

                const timer = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev <= 1) {
                            // –í—Ä–µ–º—è –≤—ã—à–ª–æ - –≤—ã–±—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Å—á–µ—Ç–æ–º
                            eliminateLowestCountry();
                            return ROUND_TIMER_SECONDS;
                        }
                        return prev - 1;
                    });
                }, 1000);

                return () => clearInterval(timer);
            }, [phase, isDemoActive, scores, activeCountries, isLoadingGifts]);

            const eliminateLowestCountry = () => {
                if (activeCountries.length <= 1) return;

                // –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–∞–Ω—É —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Å—á–µ—Ç–æ–º —Å—Ä–µ–¥–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö
                let minScore = Infinity;
                let lowestCountryId = null;

                activeCountries.forEach(id => {
                    const s = scores[id] || 0;
                    if (s < minScore) {
                        minScore = s;
                        lowestCountryId = id;
                    }
                });

                const newActive = activeCountries.filter(id => id !== lowestCountryId);
                setActiveCountries(newActive);

                // –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–∞—Å—å –æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ - –æ–Ω–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å —Ä–∞—É–Ω–¥–∞
                if (newActive.length === 1) {
                    const winnerId = newActive[0];
                    setPhase('CELEBRATING');
                    setWins(prev => ({ ...prev, [winnerId]: (prev[winnerId] || 0) + 1 }));
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        if (round < TOTAL_ROUNDS) {
                            setRound(r => r + 1);
                            setActiveCountries(COUNTRIES.map(c => c.id));
                            setScores({}); // –°–±—Ä–æ—Å –æ—á–∫–æ–≤
                            setTimeLeft(ROUND_TIMER_SECONDS);
                            setPhase('PLAYING');
                        } else {
                            setPhase('GAME_OVER');
                        }
                    }, 5000);
                }
            };

            // --- –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–î–ê–†–ö–ê ---
            const handleGift = (countryId, giftInfo, username) => {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—ã–±—ã–≤—à–∏—Ö —Å—Ç—Ä–∞–Ω
                if (!activeCountries.includes(countryId) || phase !== 'PLAYING') return;
                if (!giftInfo) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –ø—É—Å—Ç—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤

                // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏ (—É—á–∏—Ç—ã–≤–∞–µ–º cost –∏–∑ Supabase)
                const cost = giftInfo.cost || 0;
                setScores(prev => ({ ...prev, [countryId]: (prev[countryId] || 0) + cost }));

                // –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏
                setPulsingIds(prev => new Set(prev).add(countryId));
                setTimeout(() => {
                    setPulsingIds(prev => {
                        const newSet = new Set(prev);
                        newSet.delete(countryId);
                        return newSet;
                    });
                }, 400);
            };

            // --- –°–ò–ú–£–õ–Ø–¢–û–† –î–û–ù–ê–¢–û–í ---
            useEffect(() => {
                if (!isDemoActive || phase !== 'PLAYING' || isLoadingGifts) return;

                const interval = setInterval(() => {
                    if (activeCountries.length === 0) return;
                    
                    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∞–∫—Ç–∏–≤–Ω—É—é —Å—Ç—Ä–∞–Ω—É
                    const randomCountryId = activeCountries[Math.floor(Math.random() * activeCountries.length)];
                    const countryAvailGifts = countryGifts[randomCountryId];
                    if (!countryAvailGifts || countryAvailGifts.length === 0) return;
                    
                    // –í—ã–±–∏—Ä–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫ (—à–∞–Ω—Å—ã: 60% –¥–µ—à–µ–≤—ã–π, 30% —Å—Ä–µ–¥–Ω–∏–π, 8% –¥–æ—Ä–æ–≥–æ–π, 2% —Å—É–ø–µ—Ä)
                    const rand = Math.random();
                    let giftIdx = 0;
                    if (rand > 0.6 && rand <= 0.9) giftIdx = Math.min(1, countryAvailGifts.length - 1);
                    else if (rand > 0.9 && rand <= 0.98) giftIdx = Math.min(2, countryAvailGifts.length - 1);
                    else if (rand > 0.98) giftIdx = Math.min(3, countryAvailGifts.length - 1);

                    const gift = countryAvailGifts[giftIdx];
                    if (!gift) return;

                    const randomName = MOCK_NAMES[Math.floor(Math.random() * MOCK_NAMES.length)];
                    
                    handleGift(randomCountryId, gift, randomName);
                }, Math.random() * 800 + 400); // –ë—ã—Å—Ç—Ä—ã–π —Ç–µ–º–ø

                return () => clearInterval(interval);
            }, [isDemoActive, phase, activeCountries, countryGifts, isLoadingGifts]);

            // --- –°–û–†–¢–ò–†–û–í–ö–ê –î–õ–Ø –õ–ò–î–ï–†–ë–û–†–î–ê ---
            const sortedActiveCountries = useMemo(() => {
                return activeCountries
                    .map(id => ({ ...COUNTRIES.find(c => c.id === id), score: scores[id] || 0 }))
                    .sort((a, b) => b.score - a.score);
            }, [activeCountries, scores]);

            const maxScore = sortedActiveCountries[0]?.score || 1;
            const roundWinner = phase === 'CELEBRATING' ? COUNTRIES.find(c => c.id === activeCountries[0]) : null;

            if (isLoadingGifts) {
                return (
                    <div className="w-full h-screen demo-background flex items-center justify-center text-white font-sans text-2xl animate-pulse">
                        –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤...
                    </div>
                );
            }

            return (
                <div className="w-full h-screen demo-background flex flex-col items-center relative overflow-hidden text-white font-sans">
                    
                    {/* --- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ (–ü–û–ë–ï–î–´ –ò –ò–ù–§–û) --- */}
                    <div className="w-full h-[8%] min-h-[60px] bg-black/60 border-b border-white/10 flex items-center justify-between px-6 z-20 backdrop-blur-md shrink-0">
                        {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–±–µ–¥ */}
                        <div className="flex gap-4 overflow-x-auto items-center pr-4 hide-scrollbar">
                            <span className="text-gray-400 text-xs font-bold uppercase mr-2 tracking-widest">–ü–æ–±–µ–¥—ã:</span>
                            {COUNTRIES.map(c => (
                                <div key={c.id} className="flex items-center bg-white/5 rounded-full px-3 py-1 border border-white/10">
                                    <span className="text-xl mr-2 drop-shadow-md">{c.flag}</span>
                                    <span className="font-bold text-green-400">{wins[c.id] || 0}</span>
                                </div>
                            ))}
                        </div>
                        {/* –†–∞—É–Ω–¥ –∏ –î–µ–º–æ-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å */}
                        <div className="flex items-center gap-4 flex-shrink-0">
                            <div className="text-right">
                                <div className="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-yellow-500 uppercase tracking-widest">
                                    –†–∞—É–Ω–¥ {round}/{TOTAL_ROUNDS}
                                </div>
                                <div className="text-xs text-gray-400 uppercase tracking-widest">
                                    {phase === 'PLAYING' ? `–í—ã–±—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑: ${timeLeft}—Å` : '–û–∂–∏–¥–∞–Ω–∏–µ...'}
                                </div>
                            </div>
                            <button onClick={() => setIsDemoActive(!isDemoActive)} className={`text-[10px] px-2 py-1 rounded-full border ${isDemoActive ? 'border-green-500 text-green-400' : 'border-gray-500 text-gray-500'} cursor-pointer`}>
                                {isDemoActive ? 'Demo ON' : 'Demo OFF'}
                            </button>
                        </div>
                    </div>

                    {/* --- –ú–ï–°–¢–û –ü–û–î –í–ï–ë–ö–ê–ú–ï–†–£ (–°—Ç—Ä–∏–º–µ—Ä) --- */}
                    <div className="w-full h-[25%] min-h-[200px] flex items-center justify-center p-4 z-10 shrink-0">
                        <div className="w-[350px] h-full border-2 border-dashed border-white/20 rounded-2xl bg-black/20 backdrop-blur-sm flex flex-col items-center justify-center relative overflow-hidden">
                            <span className="text-white/30 text-xl font-bold uppercase tracking-widest text-center px-4">
                                –ú–µ—Å—Ç–æ –¥–ª—è –≤–µ–±–∫–∞–º–µ—Ä—ã<br/>
                                <span className="text-xs font-normal">(–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å–ª–æ–π –≤–µ–±–∫–∏ –ø–æ–¥ –≤–∏–¥–∂–µ—Ç–æ–º –≤ OBS)</span>
                            </span>
                            {/* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —É–≥–æ–ª–∫–∏ */}
                            <div className="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-cyan-500 rounded-tl-xl"></div>
                            <div className="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-cyan-500 rounded-tr-xl"></div>
                            <div className="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-cyan-500 rounded-bl-xl"></div>
                            <div className="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-cyan-500 rounded-br-xl"></div>
                        </div>
                    </div>

                    {/* --- –ö–û–ú–ü–ê–ö–¢–ù–´–ô –†–ï–ô–¢–ò–ù–ì –ü–û –¶–ï–ù–¢–†–£ --- */}
                    <div className="flex-1 w-full max-w-[500px] relative px-4 z-10 flex flex-col justify-center">
                        {phase === 'CELEBRATING' && roundWinner && (
                            <div className="absolute inset-0 z-50 flex items-center justify-center winner-anim">
                                <div className="bg-gradient-to-br from-yellow-500 via-orange-500 to-red-500 p-1 rounded-3xl shadow-[0_0_100px_rgba(255,165,0,0.6)]">
                                    <div className="bg-black/90 rounded-[22px] px-10 py-8 text-center backdrop-blur-xl flex flex-col items-center">
                                        <div className="text-8xl drop-shadow-2xl mb-4">{roundWinner.flag}</div>
                                        <h2 className="text-3xl font-black text-white uppercase tracking-wider mb-2">–ü–û–ë–ï–î–ò–¢–ï–õ–¨ –†–ê–£–ù–î–ê!</h2>
                                        <h3 className="text-xl text-yellow-400 font-bold">+1 –≤ –∫–æ–ø–∏–ª–∫—É</h3>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="relative w-full h-full" style={{ height: `${sortedActiveCountries.length * 65}px`, maxHeight: '100%' }}>
                            {sortedActiveCountries.map((country, index) => {
                                const translateY = index * 65;
                                const isFirst = index === 0;
                                const isLast = index === sortedActiveCountries.length - 1;
                                const isPulsing = pulsingIds.has(country.id);
                                const progressPercentage = Math.max(2, (country.score / maxScore) * 100);

                                return (
                                    <div 
                                        key={country.id}
                                        className={`absolute left-0 right-0 h-[55px] bg-black/60 backdrop-blur-md rounded-2xl flex items-center p-3 border transition-all duration-500 ease-in-out ${isLast && phase === 'PLAYING' && timeLeft <= 5 ? 'border-red-500/80 shadow-[0_0_15px_rgba(255,0,0,0.5)] animate-pulse' : 'border-white/10'}`}
                                        style={{ transform: `translateY(${translateY}px)`, zIndex: 20 - index }}
                                    >
                                        <div className="text-3xl mr-3 drop-shadow-md">{country.flag}</div>
                                        <div className="font-bold text-lg text-white flex-1">{country.name}</div>
                                        <div className="flex flex-col items-end z-10 ml-2">
                                            <span className={`font-black text-2xl tabular-nums ${isPulsing ? 'score-pulse' : ''} text-green-400`}>
                                                {country.score.toLocaleString('ru-RU')}
                                            </span>
                                        </div>
                                        {/* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */}
                                        <div className="absolute top-0 left-0 h-full rounded-2xl overflow-hidden opacity-30 pointer-events-none w-full">
                                            <div className="h-full progress-bar-transition bg-gradient-to-r from-green-500 to-cyan-500" style={{ width: `${progressPercentage}%` }}></div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* --- –°–ï–¢–ö–ê –ü–û–î–ê–†–ö–û–í –í–ù–ò–ó–£ (–ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –ó–†–ò–¢–ï–õ–ï–ô) --- */}
                    {/* –í—ã—Å–æ—Ç–∞ –∂–µ—Å—Ç–∫–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 35vh (35% –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞) */}
                    <div className="w-full h-[35vh] shrink-0 bg-black/80 border-t border-white/10 p-2 z-20 flex flex-col backdrop-blur-xl">
                        <div className="text-center text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 mt-1">
                            ‚¨áÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —ç—Ç–∏ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–≤–æ–µ–π —Å—Ç—Ä–∞–Ω—ã ‚¨áÔ∏è
                        </div>
                        {/* –°–µ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω: 3 –∫–æ–ª–æ–Ω–∫–∏ —Ö 2 —Å—Ç—Ä–æ–∫–∏ –¥–ª—è 6 —Å—Ç—Ä–∞–Ω */}
                        <div className="grid grid-cols-3 grid-rows-2 gap-2 h-full pb-2">
                            {COUNTRIES.map(country => {
                                const isActive = activeCountries.includes(country.id);
                                const gifts = countryGifts[country.id] || [];

                                return (
                                    <div key={country.id} className={`flex flex-col rounded-xl border ${isActive ? 'bg-white/5 border-white/10' : 'bg-white/5 border-red-500/30 opacity-40 grayscale'} overflow-hidden relative transition-all duration-500`}>
                                        
                                        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω—ã */}
                                        <div className="bg-white/10 py-1 flex items-center justify-center gap-1 border-b border-white/5">
                                            <span className="text-lg drop-shadow-sm">{country.flag}</span>
                                            <span className="text-xs font-bold text-white truncate max-w-[80px]">{country.name}</span>
                                        </div>
                                        
                                        {/* –°–µ—Ç–∫–∞ 4 –ø–æ–¥–∞—Ä–∫–æ–≤ */}
                                        <div className="grid grid-cols-2 grid-rows-2 flex-1 p-1 gap-1">
                                            {gifts.map((gift, idx) => gift ? (
                                                <div key={gift.id || idx} className="bg-black/40 rounded-lg flex flex-col items-center justify-center relative overflow-hidden group">
                                                    <span className="text-2xl mb-1 drop-shadow-[0_0_8px_rgba(255,255,255,0.3)]">{gift.icon}</span>
                                                    <div className="flex items-center text-[9px] font-black text-yellow-400 bg-black/50 px-1.5 py-0.5 rounded-full">
                                                        {gift.cost}
                                                    </div>
                                                </div>
                                            ) : null)}
                                        </div>

                                        {!isActive && (
                                            <div className="absolute inset-0 bg-red-900/40 flex items-center justify-center backdrop-blur-[1px]">
                                                <span className="text-red-500 font-black uppercase text-xl rotate-[-15deg] border-2 border-red-500 px-2 py-0.5 rounded bg-black/50">–í–´–ë–´–õ</span>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
